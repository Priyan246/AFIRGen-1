<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Module Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
        }
        .input-box {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-family: monospace;
        }
        .output-box {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            min-height: 50px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        button {
            background: #000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #333;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Security Module Test Page</h1>
    <p>Test the security.js module functions with various inputs.</p>

    <!-- Test sanitizeHTML -->
    <div class="test-section">
        <h3>Test sanitizeHTML()</h3>
        <textarea class="input-box" id="html-input" placeholder="Enter HTML to sanitize..."><script>alert('XSS')</script><p>Hello <strong>World</strong></p></textarea>
        <button onclick="testSanitizeHTML()">Sanitize HTML</button>
        <div>
            <strong>Output:</strong>
            <div class="output-box" id="html-output"></div>
        </div>
    </div>

    <!-- Test sanitizeText -->
    <div class="test-section">
        <h3>Test sanitizeText()</h3>
        <textarea class="input-box" id="text-input" placeholder="Enter text to sanitize...">Hello&#x00;World&#x01;Test</textarea>
        <button onclick="testSanitizeText()">Sanitize Text</button>
        <div>
            <strong>Output:</strong>
            <div class="output-box" id="text-output"></div>
        </div>
    </div>

    <!-- Test escapeHTML -->
    <div class="test-section">
        <h3>Test escapeHTML()</h3>
        <textarea class="input-box" id="escape-input" placeholder="Enter HTML to escape..."><script>alert("XSS")</script></textarea>
        <button onclick="testEscapeHTML()">Escape HTML</button>
        <div>
            <strong>Output:</strong>
            <div class="output-box" id="escape-output"></div>
        </div>
    </div>

    <!-- Test sanitizeURL -->
    <div class="test-section">
        <h3>Test sanitizeURL()</h3>
        <input type="text" class="input-box" id="url-input" placeholder="Enter URL to validate..." value="javascript:alert('XSS')" style="min-height: auto;">
        <button onclick="testSanitizeURL()">Validate URL</button>
        <div>
            <strong>Output:</strong>
            <div class="output-box" id="url-output"></div>
        </div>
    </div>

    <!-- XSS Test Cases -->
    <div class="test-section">
        <h3>XSS Prevention Test Cases</h3>
        <button onclick="runXSSTests()">Run All XSS Tests</button>
        <div>
            <strong>Results:</strong>
            <div class="output-box" id="xss-output"></div>
        </div>
    </div>

    <!-- Load DOMPurify and security module -->
    <script src="lib/dompurify.min.js"></script>
    <script src="js/security.js"></script>

    <script>
        function testSanitizeHTML() {
            const input = document.getElementById('html-input').value;
            const output = sanitizeHTML(input);
            document.getElementById('html-output').textContent = output;
        }

        function testSanitizeText() {
            const input = document.getElementById('text-input').value;
            const output = sanitizeText(input);
            document.getElementById('text-output').textContent = output;
        }

        function testEscapeHTML() {
            const input = document.getElementById('escape-input').value;
            const output = escapeHTML(input);
            document.getElementById('escape-output').textContent = output;
        }

        function testSanitizeURL() {
            const input = document.getElementById('url-input').value;
            const output = sanitizeURL(input);
            document.getElementById('url-output').textContent = output === null ? 'Invalid URL (rejected)' : output;
        }

        function runXSSTests() {
            const xssPayloads = [
                '<script>alert("XSS")</script>',
                '<img src=x onerror=alert("XSS")>',
                '<svg onload=alert("XSS")>',
                '<iframe src="javascript:alert(\'XSS\')">',
                '<body onload=alert("XSS")>',
                '"><script>alert("XSS")</script>',
                '<a href="javascript:alert(\'XSS\')">Click</a>',
            ];

            let results = 'Testing ' + xssPayloads.length + ' XSS payloads:\n\n';
            let passed = 0;
            let failed = 0;

            xssPayloads.forEach((payload, index) => {
                const sanitized = sanitizeHTML(payload);
                const safe = !sanitized.includes('alert') && 
                            !sanitized.includes('onerror') && 
                            !sanitized.includes('onload') &&
                            !sanitized.includes('javascript:');
                
                if (safe) {
                    passed++;
                    results += `✓ Test ${index + 1}: PASSED\n`;
                } else {
                    failed++;
                    results += `✗ Test ${index + 1}: FAILED\n`;
                }
                results += `  Input: ${payload}\n`;
                results += `  Output: ${sanitized}\n\n`;
            });

            results += `\nSummary: ${passed} passed, ${failed} failed`;
            document.getElementById('xss-output').textContent = results;
        }

        // Run initial tests on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Security module loaded successfully');
            console.log('DOMPurify version:', DOMPurify.version || 'unknown');
        });
    </script>
</body>
</html>
